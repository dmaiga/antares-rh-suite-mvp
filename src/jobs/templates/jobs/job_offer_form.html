{% extends 'authentication/base.html' %}

{% load static  %}

{% block extra_css %}
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<link href="{% static 'django_summernote/summernote.min.css' %}" rel="stylesheet">
<style>
    .form-section {
        background: white;
        border-radius: 0.5rem;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        padding: 1.5rem;
        margin-bottom: 2rem;
    }
    .note-editor {
        border-radius: 0.375rem;
        border: 1px solid #e2e8f0;
        margin-bottom: 1rem;
    }
    .note-toolbar {
        background-color: #f8fafc;
        border-bottom: 1px solid #e2e8f0;
        border-radius: 0.375rem 0.375rem 0 0;
    }
    .form-control {
        transition: all 0.2s;
    }
    .form-control:focus {
        border-color: #3b82f6;
        box-shadow: 0 0 0 1px #3b82f6;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-5xl">
    <h1 class="text-3xl font-bold mb-6 text-gray-800">
        {% if form.instance.pk %}Modifier{% else %}Créer{% endif %} une Offre
    </h1>
    
    <form method="post" enctype="multipart/form-data" class="space-y-6">
        {% csrf_token %}
        {{ form.media }}
        
        <!-- Section 1: Informations de base -->
        <div class="form-section">
            <h2 class="text-xl font-semibold mb-4 border-b pb-2 text-gray-700">Informations générales</h2>
            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">{{ form.reference.label }}</label>
                    {{ form.reference }}
                    <p class="text-xs text-gray-500 mt-1">{{ form.reference.help_text }}</p>
                    {% if form.reference.errors %}
                        <p class="text-xs text-red-500 mt-1">{{ form.reference.errors }}</p>
                    {% endif %}
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">{{ form.titre.label }}</label>
                    {{ form.titre }}
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">{{ form.type_offre.label }}</label>
                    {{ form.type_offre }}
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">{{ form.societe.label }}</label>
                    {{ form.societe }}
                </div>
            </div>
        </div>

        <!-- Section 2: Description du poste -->
        <div class="form-section">
            <h2 class="text-xl font-semibold mb-4 border-b pb-2 text-gray-700">Description du poste</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">{{ form.description_poste.label }}</label>
                    {{ form.description_poste }}
                </div>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">{{ form.mission_principale.label }}</label>
                        {{ form.mission_principale }}
                        <p class="text-xs text-gray-500 mt-1">{{ form.mission_principale.help_text }}</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">{{ form.taches.label }}</label>
                        {{ form.taches }}
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 3: Profil recherché -->
        <div class="form-section">
            <h2 class="text-xl font-semibold mb-4 border-b pb-2 text-gray-700">Profil recherché</h2>
            <div class="grid md:grid-cols-2 gap-6">
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-1">{{ form.profil_recherche.label }}</label>
                    {{ form.profil_recherche }}
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">{{ form.competences_qualifications.label }}</label>
                    {{ form.competences_qualifications }}
                    <p class="text-xs text-gray-500 mt-1">{{ form.competences_qualifications.help_text }}</p>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">{{ form.niveau_etude.label }}</label>
                    {{ form.niveau_etude }}
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">{{ form.experience_requise.label }}</label>
                    {{ form.experience_requise }}
                    <p class="text-xs text-gray-500 mt-1">{{ form.experience_requise.help_text }}</p>
                </div>
            </div>
        </div>

        <!-- Section 4: Conditions pratiques -->
        <div class="form-section">
            <h2 class="text-xl font-semibold mb-4 border-b pb-2 text-gray-700">Conditions pratiques</h2>
            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">{{ form.lieu.label }}</label>
                    {{ form.lieu }}
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">{{ form.salaire.label }}</label>
                    {{ form.salaire }}
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">{{ form.conditions.label }}</label>
                    {{ form.conditions }}
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">{{ form.contact.label }}</label>
                    {{ form.contact }}
                </div>
                
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-1">{{ form.comment_postuler.label }}</label>
                    {{ form.comment_postuler }}
                </div>
            </div>
        </div>

        <!-- Section 5: Publication -->
        <div class="form-section">
            <h2 class="text-xl font-semibold mb-4 border-b pb-2 text-gray-700">Publication</h2>
            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">{{ form.date_publication.label }}</label>
                    {{ form.date_publication }}
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">{{ form.date_limite.label }}</label>
                    {{ form.date_limite }}
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">{{ form.statut.label }}</label>
                    {{ form.statut }}
                </div>
                
                <div class="flex items-center">
                    {{ form.visible_sur_site }}
                    <label class="ml-2 text-sm font-medium text-gray-700">{{ form.visible_sur_site.label }}</label>
                </div>
                
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-1">{{ form.fichier_pdf.label }}</label>
                    {{ form.fichier_pdf }}
                    <p class="text-xs text-gray-500 mt-1">{{ form.fichier_pdf.help_text }}</p>
                </div>
            </div>
        </div>

        <!-- Boutons de soumission -->
        <div class="flex justify-end space-x-4 pt-6">
            <a href="{% if form.instance.pk %}{% url 'job-offer-detail' form.instance.pk %}{% else %}{% url 'job-offer-list' %}{% endif %}"
               class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors">
                Annuler
            </a>
            <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                Enregistrer
            </button>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script src="{% static 'django_summernote/summernote.min.js' %}"></script>
<script>
    $(document).ready(function() {
        // Initialisation de Select2
        $('.select2').select2({
            width: '100%',
            theme: 'classic'
        });
        
        // Formatage automatique des listes
        $('textarea[name="mission_principale"], textarea[name="competences_qualifications"], textarea[name="conditions"]').on('blur', function() {
            const content = $(this).val();
            if (content) {
                const lines = content.split('\n').filter(line => line.trim());
                $(this).val(lines.join('\n'));
            }
        });
        
        // Prévisualisation PDF
        $('#id_fichier_pdf').change(function() {
            if (this.files && this.files[0]) {
                const file = this.files[0];
                if (file.type === 'application/pdf') {
                    const url = URL.createObjectURL(file);
                    window.open(url, '_blank');
                }
            }
        });
    });
</script>
{% endblock %}